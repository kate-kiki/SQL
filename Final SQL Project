SELECT firstname, lastname, customerid, country
FROM chinook.customers
WHERE country <> 'USA'
ORDER BY country;

SELECT cust.FirstName, cust.LastName, inv.InvoiceId, inv.InvoiceDate, inv.BillingCountry
FROM chinook.customers AS cust
INNER JOIN chinook.invoices AS inv
    ON inv.CustomerId = cust.CustomerId
WHERE inv.BillingCountry = 'Brazil';

SELECT * FROM chinook.employees
WHERE title LIKE '%sales%agent%';

SELECT DISTINCT billingcountry
FROM chinook.invoices;

SELECT agent.FirstName, agent.LastName, inv.InvoiceID
FROM chinook.employees AS agent
JOIN chinook.customers AS cust
    ON cust.SupportRepID = agent.EmployeeId
JOIN chinook.invoices AS inv
    ON inv.CustomerId = cust.CustomerId;
    
SELECT agent.FirstName, agent.LastName,cust.FirstName, cust.LastName, cust.Country, inv.Total
FROM chinook.employees AS agent
JOIN chinook.customers AS cust
    ON cust.SupportRepID = agent.EmployeeId
JOIN chinook.invoices AS inv
    ON inv.CustomerId = cust.CustomerId;
    
SELECT COUNT(*)
FROM chinook.invoices
WHERE InvoiceDate BETWEEN '2009-01-01' AND '2009-12-31';

SELECT SUM(Total)
FROM chinook.invoices
WHERE InvoiceDate BETWEEN '2009-01-01' AND '2009-12-31';

SELECT 
    track.Name AS 'Track', 
    art.Name AS 'Artist', 
    inv.InvoiceLineId AS 'Invoice Line ID'
FROM chinook.invoice_items AS inv
JOIN chinook.invoices AS invoice
    ON invoice.InvoiceId = inv.InvoiceId
JOIN chinook.tracks AS track
    ON inv.TrackId = track.TrackId
JOIN chinook.albums AS alb
    ON track.AlbumId = alb.AlbumId
JOIN chinook.artists AS art
    ON alb.ArtistId = art.ArtistId;
    

SELECT 
    track.Name AS 'Track', 
    alb.Title AS 'Album', 
    media.Name AS 'Media',
    gen.Name AS 'Genre'
FROM chinook.tracks AS track
JOIN chinook.albums AS alb
    ON track.AlbumId = alb.AlbumId
JOIN chinook.media_types AS media
    ON track.MediaTypeId = media.MediaTypeId
JOIN chinook.genres AS gen
    ON track.GenreId = gen.GenreId;
    
SELECT 
    emp.FirstName, 
    emp.LastName,
    ROUND(SUM(Inv.Total),2) AS 'Total Sales' 
FROM chinook.employees AS emp
JOIN chinook.customers AS cust
    ON cust.SupportRepId = emp.EmployeeId
JOIN chinook.invoices AS inv
    ON inv.CustomerId = cust.CustomerId
WHERE emp.title LIKE '%sales%agent%'
GROUP BY emp.FirstName;

SELECT 
    emp.FirstName, 
    emp.LastName,
    ROUND(SUM(Inv.Total),2) AS 'Total Sales' 
FROM chinook.employees AS emp
JOIN chinook.customers AS cust
    ON cust.SupportRepId = emp.EmployeeId
JOIN chinook.invoices AS inv
    ON inv.CustomerId = cust.CustomerId
WHERE emp.title LIKE '%sales%agent%'
AND inv.InvoiceDate LIKE '2009%'
GROUP BY emp.FirstName
ORDER BY ROUND(SUM(Inv.Total),2) desc
LIMIT 1;

WITH cte_2009total AS (
    SELECT SUM(inv.Total)
    FROM chinook.invoices AS inv
    WHERE inv.InvoiceDate LIKE '2009%'),
    
    cte_2010total AS (
    SELECT SUM(inv.total)
    FROM chinook.invoices AS inv
    WHERE inv.InvoiceDate LIKE '2010%'),
    
    cte_2011total AS (
    SELECT SUM(inv.total)
    FROM chinook.invoices AS inv
    WHERE inv.InvoiceDate LIKE '2011%'),
    
    cte_2012total AS (
    SELECT SUM(inv.total)
    FROM chinook.invoices AS inv
    WHERE inv.InvoiceDate LIKE '2012%'),
    
    cte_2013total AS (
    SELECT SUM(inv.total)
    FROM chinook.invoices AS inv
    WHERE inv.InvoiceDate LIKE '2013%')
    
SELECT * FROM cte_2013total
UNION
SELECT * FROM cte_2012total
UNION
SELECT * FROM cte_2011total
UNION
SELECT * FROM cte_2010total
UNION
SELECT * FROM cte_2009total;


SELECT SUM(inv.total)
    FROM chinook.invoices AS inv
    WHERE inv.InvoiceDate LIKE ('2012%')
UNION
SELECT SUM(inv.total)
    FROM chinook.invoices AS inv
    WHERE inv.InvoiceDate LIKE '2011%')
